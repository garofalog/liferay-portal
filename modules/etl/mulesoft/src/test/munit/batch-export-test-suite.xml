<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:file="http://www.mulesoft.org/schema/mule/file"
	  xmlns:liferay="http://www.mulesoft.org/schema/mule/liferay"
	  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
	  xmlns:munit-tools="http://www.mulesoft.org/schema/mule/munit-tools"
	  xmlns="http://www.mulesoft.org/schema/mule/core"

	  xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
		http://www.mulesoft.org/schema/mule/munit-tools  http://www.mulesoft.org/schema/mule/munit-tools/current/mule-munit-tools.xsd
		http://www.mulesoft.org/schema/mule/liferay http://www.mulesoft.org/schema/mule/liferay/current/mule-liferay.xsd
		http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd ">

	<munit:config name="batch-export-test-suite.xml" />

	<configuration-properties file="automation-credentials.properties" />

	<liferay:config name="Liferay_Config">
		<liferay:basic-connection openApiSpecPath="${liferay.openApiSpecPath}" username="${liferay.username}" password="${liferay.password}" />
	</liferay:config>

	<file:config name="File_Config" >
		<file:connection workingDir="${app.home}" />
	</file:config>

	<munit:before-test name="before-batch-export-test" >
		<file:read path="products.json" config-ref="File_Config"/>
		<liferay:execute-import-create-task className="com.liferay.headless.commerce.admin.catalog.dto.v1_0.Product" config-ref="Liferay_Config"/>
	</munit:before-test>

	<munit:test name="batch-export-test" description="Export Products">
		<munit:execution >
			<liferay:execute-export-task className="com.liferay.headless.commerce.admin.catalog.dto.v1_0.Product" config-ref="Liferay_Config" fieldNames="active,catalogId,name,productType" siteId="84114"/>
		</munit:execution>
		<munit:validation>
			<munit-tools:assert-that expression="#[%dw 2.0&#10;output application/json&#10;---&#10;payload]" is="#[MunitTools::notNullValue()]" />
		</munit:validation>
	</munit:test>

	<munit:after-test name="batch-export-test-suiteAfter_Test" >
		<liferay:execute-export-task className="com.liferay.headless.commerce.admin.catalog.dto.v1_0.Product" config-ref="Liferay_Config" siteId="84114" fieldNames="active,catalogId,name,productId,productType"/>
		<liferay:execute-import-delete-task className="com.liferay.headless.commerce.admin.catalog.dto.v1_0.Product" config-ref="Liferay_Config"/>
	</munit:after-test>

</mule>

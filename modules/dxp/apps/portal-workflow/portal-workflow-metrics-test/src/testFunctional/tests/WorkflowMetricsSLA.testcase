@component-name = "portal-workflow-ee"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property test.run.environment = "EE";
	property testray.main.component.name = "Workflow Metrics";

	setUp {
		TestCase.setUpPortalInstance();

		var testPortalInstance = PropsUtil.get("test.portal.instance");

		User.firstLoginPG();

		Navigator.openURL();

		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Metrics");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
	}

	@description = "LPS-89082 - Verify that a blocked SLA can be fixed"
	@priority = "5"
	test BlockedSLACanBeFixed {
		property test.name.skip.portal.instance = "WorkflowMetricsSLA#BlockedSLACanBeFixed";

		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetricsSLA#ADD_NEW_SLA_BUTTON");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "0",
			slaDefinitionDescription = "SLA Description",
			slaDefinitionEnd = "Leaves Task: Update",
			slaDefinitionHours = "00:01",
			slaDefinitionName = "SLA Name",
			slaDefinitionStart = "Process Begins");

		Button.clickSave();

		ProductMenu.gotoPortlet(
			category = "Configuration",
			portlet = "Workflow",
			site = "Liferay DXP");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		JSONBlog.addEntry(
			entryContent = "Test content",
			entryTitle = "Test blog");

		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Workflow.gotoEditWorkflowDefinition(workflowDefinitionTitle = "Single Approver");

		KaleoDesigner.selectNode(nodeNodeLabel = "update");

		KaleoDesigner.deleteNode(nodeNodeLabel = "update");

		Button.click(button = "Update");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		WorkflowMetrics.assertWarningBlockedSlaPresent(warningMessage = "1 SLA is blocked. Fix the SLA configuration to resume accurate reporting.");

		Click(
			key_slaWarning = "Set Up SLAs",
			locator1 = "WorkflowMetricsSLA#SLA_SETUP_WARNING_BUTTON");

		WorkflowMetrics.goToEditSLA(slaName = "SLA Name");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "0",
			slaDefinitionDescription = "SLA Description",
			slaDefinitionEnd = "Leaves Task: Review",
			slaDefinitionHours = "00:01",
			slaDefinitionName = "SLA Name");

		Button.clickUpdate();

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		WorkflowMetrics.assertWarningBlockedSlaNotPresent(warningMessage = "1 SLA is blocked. Fix the SLA configuration to resume accurate reporting.");
	}

	@description = "LPS-89014 - Verify the system allow users to navigate between fields and buttons by pressing tab key considering the following order: Name > Description > Start > Pause > Stop > Days > Hours > Save button > Cancel button"
	@ignore = "Test Stub"
	@priority = "2"
	test CanNavigateByTabKeyBetweenFields {

		// TODO LRQA-67863 CanNavigateByTabKeyBetweenFields pending implementation

	}

	@description = "LPS-89014 - Verify that creating a SLA will not be reflected in completed instances"
	@ignore = "Test Stub"
	@priority = "4"
	test CreatingSLANotReflectCompletedInstances {

		// TODO LRQA-67874 CreatingSLANotReflectCompletedInstancese pending implementation

	}

	@description = "LPS-89014 - Verify that deleting a SLA will not be reflected in all completed instances"
	@ignore = "Test Stub"
	@priority = "4"
	test DeletingSLANotReflectCompletedInstances {

		// TODO LRQA-67861 DeletingSLANotReflectCompletedInstances pending implementation

	}

	@description = "LPS-89014 - Verify that deleting a SLA will be reflected in all instances In Progress"
	@ignore = "Test Stub"
	@priority = "5"
	test DeletingSLARefelctInProgressInstances {

		// TODO LRQA-67865 DeletingSLARefelctInProgressInstances pending implementation

	}

	@description = "LPS-89082 - Verify that the error alert will be displayed again when user enters the metrics page again after closing it"
	@ignore = "Test Stub"
	@priority = "2"
	test ErrorAlertIsDisplayedAgainWhenClosed {

		// TODO LRQA-67851 ErrorAlertIsDisplayedAgainWhenClosed pending implementation

	}

	@description = "LPS-89082 - Verify and click (if possible) the error messages (at metrics, SLA list, and SLA defintion page) when SLA is blocked due to workflow changes"
	@priority = "4"
	test ErrorMessagesAreDisplayedAndClickableWhenSLABlocked {
		property test.name.skip.portal.instance = "WorkflowMetricsSLA#ErrorMessagesAreDisplayedAndClickableWhenSLABlocked";

		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetricsSLA#ADD_NEW_SLA_BUTTON");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "0",
			slaDefinitionDescription = "SLA Description",
			slaDefinitionEnd = "Leaves Task: Update",
			slaDefinitionHours = "00:01",
			slaDefinitionName = "SLA Name",
			slaDefinitionStart = "Process Begins");

		Button.clickSave();

		ProductMenu.gotoPortlet(
			category = "Configuration",
			portlet = "Workflow",
			site = "Liferay DXP");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		JSONBlog.addEntry(
			entryContent = "Test content",
			entryTitle = "Test blog");

		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Workflow.gotoEditWorkflowDefinition(workflowDefinitionTitle = "Single Approver");

		KaleoDesigner.selectNode(nodeNodeLabel = "update");

		KaleoDesigner.deleteNode(nodeNodeLabel = "update");

		Button.click(button = "Update");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		WorkflowMetrics.assertWarningBlockedSlaPresent(warningMessage = "1 SLA is blocked. Fix the SLA configuration to resume accurate reporting.");

		Click(
			key_slaWarning = "Set Up SLAs",
			locator1 = "WorkflowMetricsSLA#SLA_SETUP_WARNING_BUTTON");

		WorkflowMetrics.assertErrorSlaPresent(errorMessage = "Fix blocked SLAs to resume accurate reporting.");

		Click(
			key_slaTitle = "SLA Name",
			locator1 = "WorkflowMetricsSLA#SLA_RECORD_TITLE");

		WorkflowMetrics.assertErrorSlaPresent(errorMessage = "The time frame options changed in the workflow definition. Please select new time frames.");
	}

	@description = "LPS-89014 - Verify that the field Name should be in focus at the SLA page when the user selects to edit or to create a new SLA"
	@ignore = "Test Stub"
	@priority = "3"
	test FieldNameInFocusAtSLAPage {

		// TODO LRQA-67867 FieldNameInFocusAtSLAPage pending implementation

	}

	@description = "LPS-89015 - Verify that the multi-select-fields allow to hit enter key to select an option from the dropdown list"
	@ignore = "Test Stub"
	@priority = "2"
	test MultiSelectFieldsAllowHitEnterKeyToSelectOption {

		// TODO LRQA-67877 MultiSelectFieldsAllowHitEnterKeyToSelectOption pending implementation

	}

	@description = "LPS-89015 - Verify that the multi-select-fields allow to navigate from the input field to the dropdown list vertically by using up/down keys"
	@priority = "2"
	test MultiSelectFieldsAllowNavigationByUpDownKeys {
		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetricsSLA#ADD_NEW_SLA_BUTTON");

		Click(locator1 = "WorkflowMetricsSLA#SLA_DEFINITION_START");

		KeyPress.keyDown(
			locator1 = "WorkflowMetricsSLA#SLA_DROPDOWN_START",
			value1 = "\COMMAND");

		KeyPress.keyUp(
			locator1 = "WorkflowMetricsSLA#SLA_DROPDOWN_START",
			value1 = "\COMMAND");

		Click(locator1 = "WorkflowMetricsSLA#SLA_DEFINITION_PAUSE");

		KeyPress.keyDown(
			locator1 = "WorkflowMetricsSLA#SLA_DROPDOWN_PAUSE",
			value1 = "\COMMAND");

		KeyPress.keyUp(
			locator1 = "WorkflowMetricsSLA#SLA_DROPDOWN_PAUSE",
			value1 = "\COMMAND");

		Click(locator1 = "WorkflowMetricsSLA#SLA_DEFINITION_STOP");

		KeyPress.keyDown(
			locator1 = "WorkflowMetricsSLA#SLA_DROPDOWN_STOP",
			value1 = "\COMMAND");

		KeyPress.keyUp(
			locator1 = "WorkflowMetricsSLA#SLA_DROPDOWN_STOP",
			value1 = "\COMMAND");
	}

	@description = "LPS-89015 - Verify that the multi-select-fields filter the dropdown list according to search terms"
	@ignore = "Test Stub"
	@priority = "4"
	test MultiSelectFieldsFilterDropdownListAccordingSearchTerms {

		// TODO LRQA-67873 MultiSelectFieldsFilterDropdownListAccordingSearchTerms pending implementation

	}

	@description = "LPS-89015 - Verify that the multi-select-fields provide feedback when typing terms that doesn't exist"
	@ignore = "Test Stub"
	@priority = "3"
	test MultiSelectFieldsProvideFeedbackWhenTypingNotExistentTerms {

		// TODO LRQA-67871 MultiSelectFieldsProvideFeedbackWhenTypingNotExistentTerms pending implementation

	}

	@description = "LPS-89015 - Verify that once an order option is made by the user, this definition should be saved by the system during the user stay in the Metrics context, even when the user makes a search query, reloads the page"
	@ignore = "Test Stub"
	@priority = "2"
	test MultiSelectFieldsProvideFocusWhenFieldActive {

		// TODO LRQA-67875 MultiSelectFieldsProvideFocusWhenFieldActive pending implementation

	}

	@description = "LPS-89015 - Verify the option for pause field is: On task: [task-name]"
	@ignore = "Test Stub"
	@priority = "4"
	test PauseFieldOptions {

		// TODO LRQA-67883 PauseFieldOptions pending implementation

	}

	@description = "LPS-89014 - Verify that the popover is displayed when hovering the pointer on the add button"
	@ignore = "Test Stub"
	@priority = "2"
	test PopoverIsDisplayedWhenHoveringAddButton {

		// TODO LRQA-67859 PopoverIsDisplayedWhenHoveringAddButton pending implementation

	}

	@description = "LPS-89416 - Verity the propagating info alert when updating a SLA"
	@ignore = "Test Stub"
	@priority = "3"
	test PropagatingInfoAlertDisplayedWhenUpdatingSLA {

		// TODO LRQA-67868 PropagatingInfoAlertDisplayedWhenUpdatingSLA pending implementation

	}

	@description = "LPS-89015 - Verify that the same option can't be selected in Start and Stop fields simultaneously"
	@ignore = "Test Stub"
	@priority = "5"
	test SameOptionCantBeSelectedInStartStopFields {

		// TODO LRQA-67879 SameOptionCantBeSelectedInStartStopFields pending implementation

	}

	@description = "LPS-89015 - Verify that the same task can't be selected in Start or Stop and Pause fields simultaneously"
	@ignore = "Test Stub"
	@priority = "5"
	test SameTaskCantBeSelectedInStartStopPauseFields {

		// TODO LRQA-67881 SameTaskCantBeSelectedInStartStopPauseFields pending implementation

	}

	@description = "LPS-89014 - Verify that the SLA infos are correctly displayed on the table view"
	@priority = "5"
	test SLAInfosAreCorrectlyDisplayed {
		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetricsSLA#ADD_NEW_SLA_BUTTON");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "0",
			slaDefinitionDescription = "SLA Description",
			slaDefinitionEnd = "Process Ends: Approved",
			slaDefinitionHours = "00:01",
			slaDefinitionName = "SLA Definition",
			slaDefinitionStart = "Process Begins");

		Button.clickSave();

		AssertElementPresent(
			key_slaName = "SLA Definition",
			locator1 = "WorkflowMetricsProcessListView#ASSERT_SLA_NAME");

		AssertElementPresent(
			key_columnName = "Description",
			key_fieldName = "SLA Description",
			locator1 = "WorkflowMetricsProcessListView#ASSERT_SLA_INFO");

		AssertElementPresent(
			key_columnName = "Status",
			key_fieldName = "Running",
			locator1 = "WorkflowMetricsProcessListView#ASSERT_SLA_INFO");

		AssertElementPresent(
			key_columnName = "Duration",
			key_fieldName = "1min",
			locator1 = "WorkflowMetricsProcessListView#ASSERT_SLA_INFO");

		var displayDateDay = DateUtil.getCurrentDate();
		var displayDateMonth = DateUtil.getCurrentMonthName();
		var currentDateMonthShort = StringUtil.substring("${displayDateMonth}", "0", "3");
		var displayDate = "${currentDateMonthShort} ${displayDateDay}";

		AssertElementPresent(
			key_columnName = "Last Modified",
			key_fieldName = "${displayDate}",
			locator1 = "WorkflowMetricsProcessListView#ASSERT_SLA_INFO");
	}

	@description = "LPS-89082 - Verify that the SLA list should group SLAs into Blocked and Running sections when there is at least 1 blocked SLA"
	@ignore = "Test Stub"
	@priority = "4"
	test SLAListIsGroupedWhenSLABlocked {

		// TODO LRQA-67849 SLAListIsGroupedWhenSLABlocked pending implementation

	}

	@description = "LPS-94760 - Verify that date format abbreviates the month and doesn't show year. (Example: Apr 25)"
	@ignore = "Test Stub"
	@priority = "3"
	test SLAProcessingDateAbbreviatesMonth {

		// TODO LRQA-67848 SLAProcessingDateAbbreviatesMonth pending implementation

	}

	@description = "LPS-94760 - Verify that when there is an alert message on the page, the update date should be displayed bellow it"
	@ignore = "Test Stub"
	@priority = "3"
	test SLAProcessingDateIsDisplayedUnderAlertMessage {

		// TODO LRQA-67842 SLAProcessingDateIsDisplayedUnderAlertMessage pending implementation

	}

	@description = "LPS-94760 - Verify that when there is no SLA defined to the process, the message is not displayed"
	@ignore = "Test Stub"
	@priority = "3"
	test SLAProcessingDateIsNotDisplayedWhenNoSLA {

		// TODO LRQA-67839 SLAProcessingDateIsNotDisplayedWhenNoSLA pending implementation

	}

	@description = "LPS-94760 - Verify that the time format is following the system language (Example: 03:34 PM for en_US and 15:34 for pt)"
	@ignore = "Test Stub"
	@priority = "3"
	test SLAProcessingTimeFormatIsFollowingSystemLanguage {
		var slaName = "SLAName";

		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetricsSLA#ADD_NEW_SLA_BUTTON");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "1",
			slaDefinitionDescription = "SLA Description",
			slaDefinitionEnd = "Process Ends: Approved",
			slaDefinitionHours = "0000",
			slaDefinitionName = "${slaName}",
			slaDefinitionStart = "Process Begins");

		Button.clickSave();

		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Navigator.gotoNavItem(navItem = "Configuration");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		JSONBlog.addEntry(
			entryContent = "Test Content",
			entryTitle = "Test Blog");

		WorkflowMetrics.goToWorkflowProcessMetrics(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetrics#DASHBOARD_TOTAL_PENDING_ITEMS_TITLE");

		WaitForElementPresent(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		var getInstanceId = selenium.getText("WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		Click(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		while (IsElementNotPresent(
				key_slaName = "${slaName}",
				locator1 = "WorkflowAllItems#DETAIL_PAGE_SLA_ENGLISH_HOUR_FORMAT")) {
			Click(locator1 = "WorkflowAllItems#DETAIL_PAGE_CLOSE");
			Pause(locator1 = "2000");
			Refresh();
			Click(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");
		}

		AssertElementPresent(
			key_slaName = "${slaName}",
			locator1 = "WorkflowAllItems#DETAIL_PAGE_SLA_ENGLISH_HOUR_FORMAT");

		Click(locator1 = "WorkflowAllItems#DETAIL_PAGE_CLOSE");

		UserBar.gotoDropdownItem(dropdownItem = "Account Settings");

		MyAccount.changeUserLanguage(
			languageName = "português (Brasil)",
			saveButton = "Save");

		ApplicationsMenu.gotoPortlet(
			category = "Fluxo de trabalho",
			panel = "Aplicativos",
			portlet = "Métricas");

		Click(
			key_workflowProcessName = "Aprovador Único",
			locator1 = "WorkflowMetrics#METRICS_WORKFLOW_PROCESS_NAME");

		Click(
			locator1 = "WorkflowMetrics#NEW_LANGUAGE_DASHBOARD_TOTAL_PENDING_ITEMS_TITLE",
			newLanguageCardName = "Total pendente");

		WaitForElementPresent(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		Click(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		AssertElementNotPresent(
			key_slaName = "${slaName}",
			locator1 = "WorkflowAllItems#DETAIL_PAGE_SLA_ENGLISH_HOUR_FORMAT");
	}

	@description = "LPS-89014 - Verify that the table view of SLAs are ordered by last modified (Desc)"
	@ignore = "Test Stub"
	@priority = "3"
	test SLAsAreOrderedByLasModifiedDesc {

		// TODO LRQA-67864 SLAsAreOrderedByLasModifiedDesc pending implementation

	}

	@description = "LPS-89014 - Verify that the SLA settings is available when accessing the metrics page of a process"
	@ignore = "Test Stub"
	@priority = "5"
	test SLASettingsAvailableOnMetricsPage {

		// TODO LRQA-67847 SLASettingsAvailableOnMetricsPage pending implementation

	}

	@description = "LPS-89015 - Verify the options for start field are: Process begins, Enters task: [task-name], and Leaves task: [task-name]"
	@ignore = "Test Stub"
	@priority = "4"
	test StartFieldOptions {

		// TODO LRQA-67882 StartFieldOptions pending implementation

	}

	@description = "LPS-89015 - Verify the options for stop field are: Process ends: [task-name], Enters task: [task-name], and Leaves task: [task-name]"
	@ignore = "Test Stub"
	@priority = "4"
	test StopFieldOptions {

		// TODO LRQA-67884 StopFieldOptions pending implementation

	}

	@description = "LPS-89014 - Verify the successful message when creating a SLA"
	@ignore = "Test Stub"
	@priority = "2"
	test SuccessfulMessageDisplayedWhenCreatingSLA {

		// TODO LRQA-67855 SuccessfulMessageDisplayedWhenCreatingSLA pending implementation

	}

	@description = "LPS-89014 - Verify the successful message when deleting a SLA"
	@ignore = "Test Stub"
	@priority = "2"
	test SuccessfulMessageDisplayedWhenDeletingSLA {

		// TODO LRQA-67866 SuccessfulMessageDisplayedWhenDeletingSLA pending implementation

	}

	@description = "LPS-89416 - Verify that updating a SLA will not be reflected in completed instances"
	@ignore = "Test Stub"
	@priority = "4"
	test UpdatingSLANotReflectCompletedInstances {

		// TODO LRQA-67870 UpdatingSLANotReflectCompletedInstances pending implementation

	}

	@description = "LPS-89416 - Verify that updating a SLA will recalculate time for all instances In Progress"
	@priority = "5"
	test UpdatingSLARecalculateTimeInProgressInstances {
		ApplicationsMenu.gotoPortlet(
			category = "Workflow",
			panel = "Applications",
			portlet = "Process Builder");

		Navigator.gotoNavItem(navItem = "Configuration");

		Workflow.configureWorkflow(
			workflowDefinition = "Single Approver",
			workflowResourceValue = "Blogs Entry");

		Navigator.openURL();

		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowMetricsSLA#ADD_NEW_SLA_BUTTON");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "0",
			slaDefinitionDescription = "Test Description",
			slaDefinitionEnd = "Process Ends: Approved",
			slaDefinitionHours = "00:01",
			slaDefinitionName = "Test",
			slaDefinitionStart = "Process Begins");

		Button.clickSave();

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content &amp; Data",
			panel = "Site Administration",
			portlet = "Blogs");

		Blogs.addWithWorkflow(
			entryContent = "Blogs Entry Content",
			entrySubtitle = "Subtitle",
			entryTitle = "Blogs Entry Title");

		Pause(locator1 = "50000");

		WorkflowMetrics.goToWorkflowAllItems(workflowProcessName = "Single Approver");

		WaitForElementPresent(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		var getInstanceId = selenium.getText("WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		Click(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		WorkflowMetrics.validateDueDateBySLA(
			daysLeft = "0",
			hoursLeft = "00",
			minutesLeft = "00");

		WorkflowMetrics.goToWorkflowSLASettings(workflowProcessName = "Single Approver");

		WorkflowMetrics.goToEditSLA(slaName = "Test");

		WorkflowMetrics.fillSLAForm(
			slaDefinitionDays = "0",
			slaDefinitionDescription = "Test Description",
			slaDefinitionEnd = "Process Ends: Approved",
			slaDefinitionHours = "01:00",
			slaDefinitionName = "Test",
			slaDefinitionStart = "Process Begins");

		Button.clickUpdate();

		Pause(locator1 = "35000");

		WorkflowMetrics.goToWorkflowAllItems(workflowProcessName = "Single Approver");

		Click(locator1 = "WorkflowAllItems#WORKFLOW_INSTANCE_ID");

		WorkflowMetrics.validateDueDateBySLA(
			daysLeft = "0",
			hoursLeft = "00",
			minutesLeft = "58");
	}

}